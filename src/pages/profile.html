<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../output.css" rel="stylesheet" />
    <title>TripleFun - Profile</title>
  </head>
  <body class="bg-gray-50 font-sans text-gray-800 min-h-screen flex flex-col">
    <header class="bg-sky-500 text-white p-4 shadow-md">
      <div class="container mx-auto flex flex-wrap items-center justify-start gap-2 px-4 py-2">
        <!-- Logo and Title -->
        <div class="flex items-center space-x-2 md:space-x-3 justify-center md:justify-start
                    w-full md:w-auto flex-shrink-0">
          <a href="../index.html" class="flex items-center space-x-2 md:space-x-3 cursor-pointer">
            <!-- SVG for the logo, responsive sizing with Tailwind classes -->
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 md:w-12 md:h-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 20a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2"/>
              <path d="M8 18V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v14"/>
              <path d="M10 20h4"/><circle cx="16" cy="20" r="2"/>
              <circle cx="8" cy="20" r="2"/>
            </svg>
            <!-- Title with responsive font sizes -->
            <h1 class="text-2xl md:text-4xl font-bold">TripleFun</h1>
          </a>
        </div>

        <!-- Navigation -->
        <nav class="flex justify-center
                    w-full md:w-auto order-last md:order-none flex-grow">
          <ul class="flex flex-row space-x-2 md:space-x-4 text-base md:text-xl items-center">
            <li><a href="../index.html" class="px-3 md:px-5 py-2 md:py-3 rounded-full border border-transparent hover:bg-sky-600 hover:text-white transition duration-300">Stays</a></li>
            <li><a href="../flights.html" class="px-3 md:px-5 py-2 md:py-3 rounded-full border border-transparent hover:bg-sky-600 hover:text-white transition duration-300">Flights</a></li>
          </ul>
        </nav>

        <!-- User Login/Signup -->
        <div id="user-auth-area" class="flex space-x-2 md:space-x-3 text-base md:text-xl justify-center md:justify-end items-center ml-auto
        w-full md:w-48 md:max-w-64 flex-shrink-0">
          <!-- Loading placeholder -->
          <div class="relative min-w-[273px] flex justify-center items-center space-x-2 md:space-x-3">
            <div class="w-4 h-4 md:w-5 md:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
          </div>
        </div>
      </div>
    </header>

    <!-- Profile Content -->
    <main class="container mx-auto p-6 flex-grow">
      <!-- Sub Navigation Tabs -->
      <div class="mt-6 mb-4">
        <nav class="bg-sky-100 rounded-lg p-2 flex space-x-4 text-sm font-semibold">
          <a href="profile.html" class="px-4 py-2 rounded-md text-sky-900 bg-white hover:bg-sky-200 transition">Profile</a>
          <a href="trip-history.html" class="px-4 py-2 rounded-md text-sky-900 hover:bg-sky-200 transition">Trip History</a>
          <a href="support.html" class="px-4 py-2 rounded-md text-sky-900 hover:bg-sky-200 transition">Support</a>
          <a href="setting.html" class="px-4 py-2 rounded-md text-sky-900 hover:bg-sky-200 transition">Setting</a>
        </nav>
      </div>
      <!-- Profile Header Card -->
      <div class="bg-white shadow rounded-xl p-6 flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
        <img src="../images/default-avatar.jpg" alt="User Avatar" class="w-24 h-24 rounded-full" />
        <div class="flex-1">
          <!-- User name will be dynamically updated here -->
          <h2 id="profile-username" class="text-2xl font-bold">Loading Name...</h2>
          <!-- User email will be dynamically updated here -->
          <p id="profile-email" class="text-gray-600">Loading Email...</p>
        </div>
        <a href="setting.html" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Edit Profile</a>
      </div>

      <!-- Profile Sections -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <!-- Travel Preferences -->
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-semibold mb-2">Travel Preferences</h3>
          <ul class="text-gray-700 space-y-1">
            <li>Favorite Types: Nature, Culture</li>
            <li>Preferred Mode: Self-guided</li>
            <li>Budget: $1000â€“2000</li>
            <li>Wishlist: Japan, Iceland, Peru</li>
          </ul>
        </div>

        <!-- Trip History -->
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-semibold mb-2">Recent Trips</h3>
          <ul class="text-gray-700 space-y-1">
            <li>Tokyo City Tour (May 2025)</li>
            <li>Bali Adventure (Feb 2025)</li>
            <li>Prague Cultural Walk (Dec 2024)</li>
          </ul>
        </div>

        <!-- Saved Places -->
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-semibold mb-2">Saved Destinations</h3>
          <div class="flex flex-wrap gap-2">
            <span class="bg-sky-100 text-sky-800 px-3 py-1 rounded-full text-sm">Kyoto</span>
            <span class="bg-sky-100 text-sky-800 px-3 py-1 rounded-full text-sm">Santorini</span>
            <span class="bg-sky-100 text-sky-800 px-3 py-1 rounded-full text-sm">Banff</span>
          </div>
        </div>

        <!-- Account Security -->
        <div class="bg-white rounded-lg shadow p-6">
          <h3 class="text-lg font-semibold mb-2">Account Security</h3>
          <ul class="text-gray-700 space-y-1">
            <li>Email Verified </li>
            <li>2FA: Enabled </li>
            <li>Linked Accounts: Google</li>
          </ul>
          <a href="setting.html" class="text-blue-600 text-sm mt-2 inline-block hover:underline">Manage Settings</a>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-sky-500 text-white p-3 shadow-inner">
      <div class="container mx-auto text-center text-sm">
        <p class="mb-2">&copy; 2025 TripleFun. All rights reserved.</p>
        <div class="flex justify-center space-x-4">
          <a href="#" class="hover:text-sky-200 transition duration-300">Privacy Policy</a>
          <a href="#" class="hover:text-sky-200 transition duration-300">Terms of Service</a>
        </div>
      </div>
    </footer>

    <!-- Firebase user state management and profile data loading -->
    <script type="module">
      import { initAuthState } from "../scripts/auth.js";
      import { fetchPrivateDocumentById } from "../scripts/database.js";

      // Initialize user authentication state and load profile data
      document.addEventListener('DOMContentLoaded', async () => {
        const user = await initAuthState();
        const profileUsernameElement = document.getElementById('profile-username');
        const profileEmailElement = document.getElementById('profile-email');

        if (user && profileUsernameElement && profileEmailElement) {
          try {
            // Assuming user data is stored in a 'users' collection with UID as document ID
            const userData = await fetchPrivateDocumentById(user, 'users');

            if (userData) {
              profileUsernameElement.textContent = userData.username || 'N/A';
              profileEmailElement.textContent = userData.email || 'N/A';
            } else {
              profileUsernameElement.textContent = 'User Not Found';
              profileEmailElement.textContent = 'N/A';
              console.warn("User data not found in Firestore for UID:", user.uid);
            }
          } catch (error) {
            console.error("Error fetching profile data:", error);
            profileUsernameElement.textContent = 'Error Loading Name';
            profileEmailElement.textContent = 'Error Loading Email';
          }
        } else if (profileUsernameElement && profileEmailElement) {
          // If no user is authenticated
          profileUsernameElement.textContent = 'Not Logged In';
          profileEmailElement.textContent = 'Please log in to view profile.';
        }
      });
    </script>
  </body>
</html>
